Настраиваем DAC: TSEL1 = 010 = Timer 7 TRGO event, DMAEN1 = 1
Настраиваем TIM7: Prescaler так, чтобы частота была 1МГц (увеличение счётчика каждую 1 мкс); UDE=1 (Dma en); MMS=010 (TRGO = update)
DMA DAC берёт из буфера такие значения: LVL, 0, LVL, 0,... и кладёт в DAC->DHR12L1. Буфер можно кольцевой, меняется только прии другой мощности ИК. Это мощность.
DMA TIM7 берёт из буфера такие значения: 600, (1? 1200:600), 600, (1? 1200:600),... и кладёт в TIM7->ARR.  Заполняется при формировании пакета. Это задержки.

1) пишем в DAC нужный Lvl, в TIM7->ARR -- 2400
2) стартуем TIM7, включаем выход DAC.
3) через 2400мкс:
  а) DMA of TIM7 положитв TIM7->ARR число 600
  б) DMA of DAC положит в DAC число 0 (LED off)
4) через 600мкс:
  а) DMA of TIM7 положитв TIM7->ARR нужную длительнсть
  б) DMA of DAC положит в DAC нужный уровень сигнала
  
И так далее. 